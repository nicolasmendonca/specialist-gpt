<script lang="ts">
	import { useChat } from 'ai/svelte';
	import type { PageData } from './$types';


	export let data: PageData;


	const { input, handleSubmit, messages } = useChat({
		api: data.chatUrl,
		initialMessages: data.initialMessages,
	});
</script>

<main class="relative w-full h-screen">
	<section
		class="chat-container flex flex-col-reverse max-h-screen overflow-y-scroll max-w-screen-md mx-8 lg:mx-auto pt-16 pb-32"
	>
		<div>
			{#each $messages as message}
				{@const senderIsUser = message.role === 'user'}
				{@const senderIsBot = message.role === 'assistant'}
				<div class="chat chat-start" class:chat-start={senderIsBot} class:chat-end={senderIsUser}>
					<div
						class="chat-bubble"
						class:bg-primary={senderIsUser}
						class:text-primary-content={senderIsUser}
					>
						{message.content}
					</div>
				</div>
			{/each}
		</div>
	</section>

	<form class="absolute flex px-4 gap-2 bottom-2 left-0 right-0" on:submit={handleSubmit}>
		<input bind:value={$input} type="text" class="flex-grow input input-bordered input-primary" />
		<button type="submit" class="btn btn-circle btn-primary">
			<svg
				class="w-10 h-10 rotate-90"
				viewBox="0 0 80 80"
				fill="none"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path
					class="fill-primary-content"
					fill-rule="evenodd"
					clip-rule="evenodd"
					d="M54.6368 64.9474C56.1506 66.4006 58.5954 64.8389 57.9132 62.8544L41.7497 15.8332C41.131 14.0335 38.5856 14.0334 37.9669 15.8332L22.0873 62.0287C21.4051 64.0132 23.8499 65.5749 25.3637 64.1216L38.1851 51.8131C38.959 51.0701 40.1813 51.0701 40.9552 51.8131L54.6368 64.9474Z"
				/>
				<path
					class="fill-primary-content"
					d="M38.1851 51.8131L39.5702 53.2558L38.1851 51.8131ZM40.9552 51.8131L42.3403 50.3703L40.9552 51.8131ZM25.3637 64.1216L26.7488 65.5644L25.3637 64.1216ZM57.9132 62.8544L59.8046 62.2043L57.9132 62.8544ZM39.8583 16.4834L56.0218 63.5046L59.8046 62.2043L43.6411 15.1831L39.8583 16.4834ZM23.9786 62.6788L39.8583 16.4834L36.0756 15.1831L20.1959 61.3785L23.9786 62.6788ZM26.7488 65.5644L39.5702 53.2558L36.8 50.3703L23.9786 62.6788L26.7488 65.5644ZM39.5702 53.2558L53.2517 66.3901L56.0218 63.5046L42.3403 50.3703L39.5702 53.2558ZM39.5702 53.2558H39.5702L42.3403 50.3703C40.7924 48.8844 38.3479 48.8844 36.8 50.3703L39.5702 53.2558ZM20.1959 61.3785C18.8315 65.3475 23.7211 68.4709 26.7488 65.5644L23.9786 62.6788C23.965 62.6919 23.9563 62.6981 23.9532 62.7002C23.9502 62.7022 23.9509 62.7014 23.9553 62.6995C23.9597 62.6975 23.9658 62.6954 23.973 62.6936C23.9801 62.6919 23.9868 62.691 23.9925 62.6906C24.0039 62.6899 24.0077 62.6916 24.0035 62.6905C24.0014 62.6899 23.9979 62.6888 23.9934 62.6868C23.9888 62.6847 23.9837 62.6821 23.9786 62.6788C23.9735 62.6756 23.969 62.6721 23.9652 62.6688C23.9615 62.6655 23.959 62.6628 23.9576 62.6612C23.9548 62.6578 23.9579 62.6605 23.9621 62.6712C23.9642 62.6765 23.9661 62.683 23.9676 62.6902C23.969 62.6974 23.9696 62.7038 23.9697 62.7086C23.9698 62.7135 23.9694 62.7145 23.9699 62.7109C23.9705 62.7072 23.9725 62.6967 23.9786 62.6788L20.1959 61.3785ZM56.0218 63.5046C56.028 63.5224 56.03 63.533 56.0305 63.5366C56.0311 63.5403 56.0307 63.5393 56.0308 63.5344C56.0309 63.5296 56.0315 63.5232 56.0329 63.5159C56.0344 63.5087 56.0363 63.5023 56.0384 63.497C56.0426 63.4863 56.0457 63.4836 56.0429 63.4869C56.0415 63.4886 56.039 63.4913 56.0353 63.4946C56.0315 63.4979 56.027 63.5013 56.0219 63.5046C56.0167 63.5078 56.0117 63.5105 56.0071 63.5125C56.0025 63.5146 55.9991 63.5157 55.997 63.5163C55.9928 63.5174 55.9966 63.5157 56.008 63.5164C56.0137 63.5168 56.0204 63.5177 56.0275 63.5194C56.0347 63.5211 56.0407 63.5233 56.0451 63.5252C56.0496 63.5272 56.0503 63.528 56.0473 63.5259C56.0442 63.5239 56.0354 63.5176 56.0218 63.5046L53.2517 66.3901C56.2793 69.2967 61.169 66.1733 59.8046 62.2043L56.0218 63.5046ZM43.6411 15.1831C42.4037 11.5835 37.3129 11.5835 36.0756 15.1831L39.8583 16.4834C39.8626 16.4708 39.866 16.4642 39.8672 16.462C39.8683 16.4599 39.8681 16.4607 39.866 16.4634C39.8639 16.4662 39.8609 16.4695 39.8571 16.4731C39.8533 16.4766 39.8496 16.4794 39.8463 16.4817C39.8397 16.4861 39.8368 16.4865 39.8396 16.4857C39.8428 16.4847 39.8495 16.4834 39.8583 16.4834C39.8672 16.4834 39.8738 16.4847 39.877 16.4857C39.8798 16.4865 39.8769 16.4861 39.8703 16.4817C39.867 16.4794 39.8633 16.4766 39.8595 16.4731C39.8558 16.4695 39.8528 16.4662 39.8507 16.4634C39.8486 16.4607 39.8483 16.4599 39.8495 16.462C39.8506 16.4642 39.854 16.4709 39.8583 16.4834L43.6411 15.1831Z"
				/>
			</svg>
		</button>
	</form>
</main>
